const WALLET_SERVICE_URL="https://5d073b61fa00250014577c37.mockapi.io/wallet",MINER_POOL_URL="https://eth.2miners.com/api/accounts/",PRICE_SERVICE_URL="https://api.coingecko.com/api/v3/simple/price?vs_currencies=usd&ids=ethereum",REWARD_SERVICE_URL="https://5d073b61fa00250014577c37.mockapi.io/reward",WALLETS=[{createdAt:"2021-06-25T03:02:54.232Z",address:"13NknbGKvD79sNR1YjbvwvceNEEX82E9tP",name:"daulay",id:"1"},{createdAt:"2021-06-24T19:43:37.322Z",address:"16eoDJis8ELeL7R1vLPb2mzHZUJD6Q7tHT",name:"lcl",id:"2"},{createdAt:"2021-06-25T03:02:54.232Z",address:"0x866d5887f3585d24def05c19d6484ae6af49892e",name:"luanchuong",id:"3"},{createdAt:"2021-06-24T19:43:37.322Z",address:"14J3iotu2KfZAge3eSCdQrkL1G3uFgRA45",name:"tinEth",id:"4"},{createdAt:"2021-06-24T19:43:37.322Z",address:"nano_3hdaqgjf1c6f58pqago1apz9qywnjtrxpnpk5rxzqpxetqt6c8xame1mbe8q",name:"tula",id:"5"},{createdAt:"2021-06-24T19:43:37.322Z",address:"1321aJoCfS2BsFPmA1VAGrJ1rZ9GDbX6An",name:"daulay2",id:"6"},{createdAt:"2021-06-24T19:43:37.322Z",address:"186QMAbopPfZBzFqqdbSHVieoojnvhws9k",name:"thien1",id:"7"},{createdAt:"2021-06-24T19:43:37.322Z",address:"1P2KYdCiqacTX9e2wE9zQxsZrPP1NxiSPY",name:"anhluan",id:"8"}];var vapp=new Vue({el:"#app",data:{wallets:[],price:0,miners:[],twallet:[],c:0},methods:{getEthPrice:function(){this.$http.get(PRICE_SERVICE_URL).then(e=>{let t=e.body;this.price=t.ethereum.usd},e=>{console.log(e)})},getAllWallet:function(){this.$http.get(WALLET_SERVICE_URL).then(e=>{this.loadMiners(e.body)},e=>{this.loadMiners(WALLETS)})},formatNumber:function(e,t){return e.toFixed(t).replace(/\d(?=(\d{3})+\.)/g,"$&,")},formatNumber1:function(e,t){let a=e.toFixed(t).replace(/\d(?=(\d{3})+\.)/g,"$&,");for(;a.endsWith("0");)a=a.substring(0,a.length-1);return a},formatDateTime:function(e){let t=new Date(1e3*e);return moment(t).fromNow()},formatHashrate:function(e){let t=e/1e6;return t>=1e3?this.formatNumber(e/1e9,2)+" GH/s":this.formatNumber(t,1)+" MH/s"},formatWorkerHashrate:function(e){let t=e/1e6;return this.formatNumber(t,0)},compare:function(e,t){return e.details.workersTotal>t.details.workersTotal?-1:e.details.workersTotal<t.details.workersTotal?1:e.id<t.id?-1:e.id>t.id?1:0},getTimestamp:function(){let e=new Date;return e.setHours(0,0,0,0),[moment(e).add(-1,"days").unix(),moment(e).unix(),moment(e).add(1,"days").unix()]},getReward:function(e,t,a){return null==e?0:e.filter(e=>e.timestamp>=t&&e.timestamp<a).map(e=>e.reward).reduce((e,t)=>e+t,0)},getTodayReward:function(e){let t=this.getTimestamp();return this.getReward(e,t[1],t[2])},getYesterReward:function(e){let t=this.getTimestamp();return this.getReward(e,t[0],t[1])},loadMiners:function(e){this.c=0,this.twallet=[],e.forEach(t=>{this.$http.get(MINER_POOL_URL+t.address).then(a=>{let r=a.body;r.sumrewards.splice(3,0,{inverval:0,reward:this.getTodayReward(r.rewards),numreward:0,name:"Today",offset:0}),r.sumrewards.splice(4,0,{inverval:0,reward:this.getYesterReward(r.rewards),numreward:0,name:"Yesterday",offset:0}),this.twallet.push({id:t.id,name:t.name,address:t.address,details:r}),this.c==e.length-1&&(this.wallets=this.twallet.sort(this.compare),this.saveYesterdayReward()),this.c++},e=>{console.log(e)})})},saveYesterdayReward:function(){let e=new Date;if(e.setHours(8,0,0,0),new Date<e)return;let t=localStorage.getItem("lastUpdate"),a=moment(new Date).add(-1,"days").format("DD/MM/YYYY");null!=t&&t==a||(this.$http.get(`${REWARD_SERVICE_URL}?date=${a}`).then(e=>{let t=e.body,r=this.wallets.filter(e=>t.every(t=>t.wallet!=e.address)).map(e=>({reward:this.getYesterReward(e.details.rewards),wallet:e.address,date:a}));r.length>0&&this.postReward(r)},e=>{console.log(e)}),localStorage.setItem("lastUpdate",a))},postReward:async function(e){for(let t=0;t<e.length;t++){await this.$http.post(REWARD_SERVICE_URL,e[t])}},test:async function(){for(let e=0;e<10;e++){let t=await this.test1({name:e,avatar:`avatar${e}`});console.log(t),console.log(moment(new Date).format("YYYY-MM-DDTHH:mm:ss.SSS"))}},test1:async function(e){return await this.$http.post("https://5d073b61fa00250014577c37.mockapi.io/test",e)}},mounted:function(){this.getEthPrice(),this.getAllWallet()}});$(document).ready(function(){setInterval(function(){$("#autoUpdate").is(":checked")&&vapp.getAllWallet()},9e4)});