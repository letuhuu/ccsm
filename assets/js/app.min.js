const WALLET_SERVICE_URL="https://5d073b61fa00250014577c37.mockapi.io/wallet",MINER_POOL_URL="https://eth.2miners.com/api/accounts/",PRICE_SERVICE_URL="https://api.coingecko.com/api/v3/simple/price?vs_currencies=usd&ids=ethereum",REWARD_SERVICE_URL="https://5d073b61fa00250014577c37.mockapi.io/reward",WALLETS=[{id:1,name:"daulay",address:"0xdd5b869766620e3f0d744025e9ea04e2dd14eeb5"},{id:2,name:"tula",address:"0xa9c49f21a88e68c5e66c7209ee3ddd079b321dfa"},{id:3,name:"lcl",address:"0xf0e1ed8c1f1883b4476169cadcd6fb5b91ccb601"},{id:4,name:"luandalat",address:"0xd4b975c189b115f191787d672f8a1610ff2ab49d"},{id:5,name:"tinETH",address:"0xf6dcf27342e87422e965169effac2580d9c1788f"},{id:6,name:"luanchuong",address:"0x866d5887f3585d24def05c19d6484ae6af49892e"}];var vapp=new Vue({el:"#app",data:{wallets:[],price:0,miners:[],twallet:[],c:0},methods:{getEthPrice:function(){this.$http.get(PRICE_SERVICE_URL).then(e=>{let t=e.body;this.price=t.ethereum.usd},e=>{console.log(e)})},getAllWallet:function(){this.$http.get(WALLET_SERVICE_URL).then(e=>{this.loadMiners(e.body)},e=>{this.loadMiners(WALLETS)})},formatNumber:function(e,t){return e.toFixed(t).replace(/\d(?=(\d{3})+\.)/g,"$&,")},formatNumber1:function(e,t){let a=e.toFixed(t).replace(/\d(?=(\d{3})+\.)/g,"$&,");for(;a.endsWith("0");)a=a.substring(0,a.length-1);return a},formatDateTime:function(e){let t=new Date(1e3*e);return moment(t).fromNow()},formatHashrate:function(e){let t=e/1e6;return t>=1e3?this.formatNumber(e/1e9,2)+" GH/s":this.formatNumber(t,1)+" MH/s"},formatWorkerHashrate:function(e){let t=e/1e6;return this.formatNumber(t,0)},compare:function(e,t){return e.details.workersTotal>t.details.workersTotal?-1:e.details.workersTotal<t.details.workersTotal?1:e.id<t.id?-1:e.id>t.id?1:0},getTimestamp:function(){let e=new Date;return e.setHours(0,0,0,0),[moment(e).add(-1,"days").unix(),moment(e).unix(),moment(e).add(1,"days").unix()]},getReward:function(e,t,a){return e.filter(e=>e.timestamp>=t&&e.timestamp<a).map(e=>e.reward).reduce((e,t)=>e+t,0)},getTodayReward:function(e){let t=this.getTimestamp();return this.getReward(e,t[1],t[2])},getYesterReward:function(e){let t=this.getTimestamp();return this.getReward(e,t[0],t[1])},loadMiners:function(e){this.c=0,this.twallet=[];e.forEach(t=>{this.$http.get(MINER_POOL_URL+t.address).then(a=>{let s=a.body;s.sumrewards.splice(3,0,{inverval:0,reward:this.getTodayReward(s.rewards),numreward:0,name:"Today",offset:0}),s.sumrewards.splice(4,0,{inverval:0,reward:this.getYesterReward(s.rewards),numreward:0,name:"Yesterday",offset:0}),this.twallet.push({id:t.id,name:t.name,address:t.address,details:s}),this.c==e.length-1&&(this.wallets=this.twallet.sort(this.compare),this.saveYesterdayReward()),this.c++},e=>{console.log(e)})})},saveYesterdayReward:function(){let e=localStorage.getItem("lastUpdate"),t=moment(new Date).add(-1,"days").format("DD/MM/YYYY");null!=e&&e==t||(this.$http.get(`${REWARD_SERVICE_URL}?date=${t}`).then(e=>{let a=e.body,s=this.wallets.filter(e=>a.every(t=>t.wallet!=e.address)).map(e=>({reward:this.getYesterReward(e.details.rewards),wallet:e.address,date:t}));s.length>0&&this.postReward(s)},e=>{console.log(e)}),localStorage.setItem("lastUpdate",t))},postReward:async function(e){for(let t=0;t<e.length;t++){await this.$http.post(REWARD_SERVICE_URL,e[t])}},test:async function(){for(let e=0;e<10;e++){let t=await this.test1({name:e,avatar:`avatar${e}`});console.log(t),console.log(moment(new Date).format("YYYY-MM-DDTHH:mm:ss.SSS"))}},test1:async function(e){return await this.$http.post("https://5d073b61fa00250014577c37.mockapi.io/test",e)}},mounted:function(){this.getEthPrice(),this.getAllWallet()}});$(document).ready(function(){setInterval(function(){$("#autoUpdate").is(":checked")&&vapp.getAllWallet()},9e4)});