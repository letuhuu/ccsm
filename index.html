<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Test Coingecko</title>
    <meta name="description" content="Coingecko">
    <meta name="author" content="dmap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
        integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.min.js"
        integrity="sha256-KSlsysqp7TXtFo/FHjb1T9b425x3hrvzjMWaJyKbpcI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.2/dist/vue-resource.min.js"
        integrity="sha256-bo2QIPkpVnhGaoXpy97bY7D3IKWWX0TqOU2/ANBD4v4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/currency.js@2.0.3/dist/currency.min.js"
        integrity="sha256-WGXmCGFm1BJY0ZVHoBOl15eOyHz4ICCwbaNyP6DHtbQ=" crossorigin="anonymous"></script>
    <style>
        .bold {
            font-weight: bold;
            color: forestgreen;
        }
    </style>
</head>

<body style="padding: 20px;">
    <div id="app">
        <h3 style="text-align: center;">Coingecko API</h3>
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Token</th>
                    <th scope="col">Amount</th>
                    <th scope="col">Price (USD)</th>
                    <th scope="col">Total (USD)</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="(c, i) in coin_list">
                    <th scope="row">{{i+1}}</th>
                    <td>{{c.desc}}</td>
                    <td>{{formatNumber(c.amount,5)}}</td>
                    <td>{{currency(c.price,{decimal:'.', precision: 8}).format()}}</td>
                    <td v-bind:class="i<=4?'bold':''">{{currency(c.amount*c.price, { decimal: '.'}).format()}}</td>
                </tr>
                <tr>
                    <th></th>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>
                        <h4>Sum: {{currency(sum(),{precision: 2, decimal: '.'}).format()}}</h4>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        var app = new Vue({
            el: '#app',
            data: {
                coin_list: [
                    { name: "moonmoon", desc: "MoonMoon", amount: 88942601, price: 0 },
                    { name: "bscview", desc: "Bscview", amount: 32.3, price: 0 },
                    { name: "xbn-community-token", desc: "XBN Community Token", amount: 372123022, price: 0 },
                    { name: "papel", desc: "Papel Token", amount: 100000255, price: 0 },
                    { name: "secured-moonrat-token", desc: "Secured MoonRat Token", amount: 79880324, price: 0 },
                    { name: "moontoken", desc: "MoonToken", amount: 77084992, price: 0 },
                    { name: "moonboys", desc: "MoonBoys ", amount: 60671252, price: 0 },
                    { name: "chow-chow-finance", desc: "Chow Chow Finance", amount: 606.9, price: 0 },
                    { name: "satozhi", desc: "Satozhi", amount: 28.4, price: 0 },
                    { name: "binancecoin", desc: "Binance Coin", amount: 0.0213151, price: 0 },
					{ name: "wbnb", desc: "W Binance Coin", amount: 0.00036735, price: 0 },
                    { name: "nftswaps", desc: "NFTSwaps", amount: 8.13, price: 0 },
                    { name: "safetoken", desc: "SafeToken (SAFETOKEN)", amount: 487186000, price: 0 },
                    { name: "shiba-inu", desc: "Shiba Inu (SHIB)", amount: 2914602, price: 0 }
                ],
                message: 'Hello Vue!'
            },
            methods: {
                getCoinPrice: function (ids) {
                    let url = "https://api.coingecko.com/api/v3/simple/price?vs_currencies=usd&ids=" + ids;
                    this.$http.get(url).then(response => {
                        let r = response.body;
                        //console.log(r);
                        this.coin_list.forEach(c => {
                            //console.log(c.name);
                            let price = r[c.name].usd
                            //console.log(price);
                            if (price.toString().includes('e')) {
                                price = (price).toFixed(10)
                            }
                            c.price = price;
                        });
                        this.coin_list = this.coin_list.sort(this.compare)
                        let shiba = this.coin_list.find(n=>n.name == 'shiba-inu');
                        document.title = shiba.amount * shiba.price;
                    }, response => {
                        console.log(response)
                    });
                },
                formatNumber: function (number, precision) {
                    return (number).toFixed(precision).replace(/\d(?=(\d{3})+\.)/g, '$&,')
                },
                compare: function (a, b) {
                    if ((a.amount * a.price) > (b.amount * b.price)) {
                        return -1;
                    }
                    if ((a.amount * a.price) < (b.amount * b.price)) {
                        return 1;
                    }
                    return 0;
                },
                sum: function () {
                    return this.coin_list.map(n => n.amount * n.price).reduce((a, b) => a + b, 0)
                }
            },
            mounted: function () {
                let ids = this.coin_list.map(n => n.name).join(',');
                this.getCoinPrice(ids);
                setInterval(() => {
                    this.getCoinPrice(ids);
                }, 120000);

                let url = "https://eth.2miners.com/api/accounts/0xdd5b869766620e3f0d744025e9ea04e2dd14eeb5";
                let headers = {
                    'Content-Type': 'application/json',
                    "x-auth-token": "05e3ea03-5088-4e37-ba5b-c8de78fe6bee",
                    "User-Agent":"test"
                }
                let data = { owner_uid : "2e63d448-3ce6-4efd-914a-2f7fb1dfc5eb", pagination :  { count : 50, offset : 0 } }
                this.$http.get(url).then(response => {
                    console.log(response);                        
                }, response => {
                    console.log(response)
                });
            }
        })
    </script>
</body>

</html>